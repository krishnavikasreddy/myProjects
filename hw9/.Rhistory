setwd("Documents/projects/R/hw9")
library(data.table)
flu=fread("flue.txt")
m8=glm(y~x1+x2,family = binomial(link = "logit"),data=flu)
lgit_val=log(m8$fitted.values/(1-m8$fitted.values))
o11=order(lgit_val) # order it by logit values
#divide into 8 groups but the group has only 159 so lets keep the first 19 and rest all 20
g1=lgit_val[o11[1:19]]
g11=sum(m8$fitted.values[o11[1:19]])
g2=lgit_val[o11[20:39]]
g21=sum(m8$fitted.values[o11[20:39]])
g3=lgit_val[o11[40:59]]
g31=sum(m8$fitted.values[o11[40:59]])
g4=lgit_val[o11[60:79]]
g41=sum(m8$fitted.values[o11[60:79]])
g5=lgit_val[o11[80:99]]
g51=sum(m8$fitted.values[o11[80:99]])
g6=lgit_val[o11[100:119]]
g61=sum(m8$fitted.values[o11[100:119]])
g7=lgit_val[o11[120:139]]
g71=sum(m8$fitted.values[o11[120:139]])
g8=lgit_val[o11[140:159]]
g81=sum(m8$fitted.values[o11[140:159]])
c11=c(mean(g1),mean(g2),mean(g3),mean(g4),mean(g5),mean(g6),mean(g7),mean(g8))
c12=c(g11,g21,g31,g41,g51,g61,g71,g81)
plot(c11,c12)
setnames(flu,c("y","x1","x2","x3"))
m8=glm(y~x1+x2,family = binomial(link = "logit"),data=flu)
lgit_val=log(m8$fitted.values/(1-m8$fitted.values))
o11=order(lgit_val) # order it by logit values
g1=lgit_val[o11[1:19]]
g11=sum(m8$fitted.values[o11[1:19]])
g2=lgit_val[o11[20:39]]
g21=sum(m8$fitted.values[o11[20:39]])
g3=lgit_val[o11[40:59]]
g31=sum(m8$fitted.values[o11[40:59]])
g4=lgit_val[o11[60:79]]
g41=sum(m8$fitted.values[o11[60:79]])
g5=lgit_val[o11[80:99]]
g51=sum(m8$fitted.values[o11[80:99]])
g6=lgit_val[o11[100:119]]
g61=sum(m8$fitted.values[o11[100:119]])
g7=lgit_val[o11[120:139]]
g71=sum(m8$fitted.values[o11[120:139]])
g8=lgit_val[o11[140:159]]
g81=sum(m8$fitted.values[o11[140:159]])
c11=c(mean(g1),mean(g2),mean(g3),mean(g4),mean(g5),mean(g6),mean(g7),mean(g8))
c12=c(g11,g21,g31,g41,g51,g61,g71,g81)
plot(c11,c12)
m1=glm(y~.,family = binomial(link = "logit"),data=flu)
z095=qnorm(0.975) # 1.955
sm1=summary(m1)
b1=sm1$coefficients[2,1]
sd_b1=sm1$coefficients[2,2]
confint_b1=c((b1-(z095*sd_b1)),(b1+(z095*sd_b1)))
#odds for 1 year change is
exp(confint_b1)
#odds for 30 year change is
exp(confint_b1*30)
b2=sm1$coefficients[3,1]
sd_b2=sm1$coefficients[3,2]
confint_b2=c((b2-(z095*sd_b2)),(b2+(z095*sd_b2)))
#odds for 1 unit change is
exp(confint_b2)
#odds for 25 unit change is
exp(confint_b2*25)
g80=g81-g80
g80=20-g81
g80
g1=lgit_val[o11[1:19]]
g11=sum(m8$fitted.values[o11[1:19]])
g10=19-sum(m8$fitted.values[o11[1:19]])
g2=lgit_val[o11[20:39]]
g21=sum(m8$fitted.values[o11[20:39]])
g20=20-sum(m8$fitted.values[o11[20:39]])
g3=lgit_val[o11[40:59]]
g31=sum(m8$fitted.values[o11[40:59]])
g30=20-sum(m8$fitted.values[o11[40:59]])
g4=lgit_val[o11[60:79]]
g41=sum(m8$fitted.values[o11[60:79]])
g40=20-sum(m8$fitted.values[o11[60:79]])
g5=lgit_val[o11[80:99]]
g51=sum(m8$fitted.values[o11[80:99]])
g50=20-g51
g6=lgit_val[o11[100:119]]
g61=sum(m8$fitted.values[o11[100:119]])
g60=20-g61
g7=lgit_val[o11[120:139]]
g71=sum(m8$fitted.values[o11[120:139]])
g70=20-g71
g8=lgit_val[o11[140:159]]
g81=sum(m8$fitted.values[o11[140:159]])
g80=20-g81
c11=c(mean(g1),mean(g2),mean(g3),mean(g4),mean(g5),mean(g6),mean(g7),mean(g8))
c12=c(g11,g21,g31,g41,g51,g61,g71,g81)
plot(c11,c12)
c14=c(19-mean(g1),20-mean(g2),20-mean(g3),20-mean(g4),20-mean(g5),20-mean(g6),20-mean(g7),20-mean(g8))
c14
c11
o11=sum(flu$y[o11[1:19]])
o11
summary(m1)
g1=lgit_val[o11[1:19]]
g11=sum(m8$fitted.values[o11[1:19]])
g10=19-sum(m8$fitted.values[o11[1:19]])
o11=sum(flu$y[o11[1:19]])
o10=19-011
g2=lgit_val[o11[20:39]]
g21=sum(m8$fitted.values[o11[20:39]])
g20=20-sum(m8$fitted.values[o11[20:39]])
o21=sum(flu$y[o11[20:39]])
o20=20-o21
g3=lgit_val[o11[40:59]]
g31=sum(m8$fitted.values[o11[40:59]])
g30=20-sum(m8$fitted.values[o11[40:59]])
o31=sum(flu$y[o11[40:59]])
o30=20-o31
g4=lgit_val[o11[60:79]]
g41=sum(m8$fitted.values[o11[60:79]])
g40=20-sum(m8$fitted.values[o11[60:79]])
o41=sum(flu$y[o11[60:79]])
o40=20-o41
g5=lgit_val[o11[80:99]]
g51=sum(m8$fitted.values[o11[80:99]])
g50=20-g51
o51=sum(flu$y[o11[80:99]])
o50=20-o51
g6=lgit_val[o11[100:119]]
g61=sum(m8$fitted.values[o11[100:119]])
g60=20-g61
o61=sum(flu$y[o11[100:119]])
o60=19-o61
g7=lgit_val[o11[120:139]]
g71=sum(m8$fitted.values[o11[120:139]])
g70=20-g71
o71=sum(flu$y[o11[120:139]])
o70=20-o71
g8=lgit_val[o11[140:159]]
g81=sum(m8$fitted.values[o11[140:159]])
g80=20-g81
o81=sum(flu$y[o11[140:159]])
o80=20-o81
c11=c(mean(g1),mean(g2),mean(g3),mean(g4),mean(g5),mean(g6),mean(g7),mean(g8))
c12=c(g11,g21,g31,g41,g51,g61,g71,g81)
plot(c11,c12)
o111=c(o11,o21,o31,o41,o51,o61,o71,o81)
o110=c(o10,o20,o30,o40,o50,o60,o70,o80)
c11
g1
g
g2
lgit_val=log(m8$fitted.values/(1-m8$fitted.values))
lgit_val
o11=order(lgit_val) # order it by logit values
o11
g1=lgit_val[o11[1:19]]
g1
g1=lgit_val[o11[1:19]]
g11=sum(m8$fitted.values[o11[1:19]])
g10=19-sum(m8$fitted.values[o11[1:19]])
o011=sum(flu$y[o11[1:19]])
o010=19-o011
g2=lgit_val[o11[20:39]]
g21=sum(m8$fitted.values[o11[20:39]])
g20=20-sum(m8$fitted.values[o11[20:39]])
o21=sum(flu$y[o11[20:39]])
o20=20-o21
g3=lgit_val[o11[40:59]]
g31=sum(m8$fitted.values[o11[40:59]])
g30=20-sum(m8$fitted.values[o11[40:59]])
o31=sum(flu$y[o11[40:59]])
o30=20-o31
g4=lgit_val[o11[60:79]]
g41=sum(m8$fitted.values[o11[60:79]])
g40=20-sum(m8$fitted.values[o11[60:79]])
o41=sum(flu$y[o11[60:79]])
o40=20-o41
g5=lgit_val[o11[80:99]]
g51=sum(m8$fitted.values[o11[80:99]])
g50=20-g51
o51=sum(flu$y[o11[80:99]])
o50=20-o51
g6=lgit_val[o11[100:119]]
g61=sum(m8$fitted.values[o11[100:119]])
g60=20-g61
o61=sum(flu$y[o11[100:119]])
o60=19-o61
g7=lgit_val[o11[120:139]]
g71=sum(m8$fitted.values[o11[120:139]])
g70=20-g71
o71=sum(flu$y[o11[120:139]])
o70=20-o71
g8=lgit_val[o11[140:159]]
g81=sum(m8$fitted.values[o11[140:159]])
g80=20-g81
o81=sum(flu$y[o11[140:159]])
o80=20-o81
c11=c(mean(g1),mean(g2),mean(g3),mean(g4),mean(g5),mean(g6),mean(g7),mean(g8))
c12=c(g11,g21,g31,g41,g51,g61,g71,g81)
plot(c11,c12)
o111=c(o011,o21,o31,o41,o51,o61,o71,o81)
o110=c(o010,o20,o30,o40,o50,o60,o70,o80)
o111
o110
(o111-c11)^2/c11
sum((o111-c11)^2/c11)
o81
c11
o81-meaan(g8)
o81-mean(g8)
(o81-mean(g8))
(o81-mean(g8))^2
(o81-mean(g8))^2/mean(98)
(o81-mean(g8))^2/mean(g8)
g8
c13
c13=c(g10,g20,g30,g40,g50,g60,g70,g80)
c13
(o111-c12)^2/(c12)
sum((o111-c12)^2/(c12))
(o110-c13)^2/(c13)
sum((o110-c13)^2/(c13))
qchisq(0.95,6)
chisq_1=sum((o111-c12)^2/(c12))+sum((o110-c13)^2/(c13))
chisq_1
qchisq(0.95,6)
c12
c13
o111
o010
o110
sum((o111-c12)^2/(c12))
sum((o110-c13)^2/(c13))
(o110-c13)^2/(c13)
((o110-c13)^2/(c13))
(o111-c12)^2/(c12)
o111
c12
(o111-c12)^2
pchisq(12.76,df=6)
pchisq(12.116,df=6)
?pchisq
1-pchisq(12.116,df=6)
chisq_1
pchisq(12.72676,6)
residuals(m1,"deviance")
?residuals
rstandard(m1,"deviance")
rstandard(m1,type="deviance")
plot(rstandard(m1,type="deviance"),m1$fitted.values)
plot(m1$fitted.values,rstandard(m1,type="deviance"))
lowess(m1$fitted.values,rstandard(m1,type="deviance"))
plot(lowess(m1$fitted.values,rstandard(m1,type="deviance")))
plot(lowess(m8$fitted.values,rstandard(m8,type="deviance")))
c1=0.05
risk<-exp(m1$fitted.values)/(1+exp(m1$fitted.values))
pred.shot<-(risk>c1)
table(pred.shot[flu$y==0])
pred.shot<-(risk>c1)
pred.shot
risk<-m1$fitted.values
risk>0.05
pred.shot<-(risk>c1)
pred.shot
table(pred.shot[flu$y==0])
enotd=table(pred.shot[flu$y==0])[1]/length(flu[flu$y==0])
enotd
length(flu[flu$y==0])
length(flu$y[flu$y==0])
enotd=table(pred.shot[flu$y==0])[1]/length(flu$y[flu$y==0])
enotd
ewithd= table(pred.shot[flu$y==0])[0]/length(flu$y[flu$y==1])
ewithd
enotd=table(pred.shot[flu$y==0])[2]/length(flu$y[flu$y==0])
enotd
cutoff<-seq(0.05,0.2, by=0.05)
risk<-m1$fitted.values
for(c1 in cutoff){
pred.shot<-(risk>c1)
enotd=table(pred.shot[flu$y==0])[2]/length(flu$y[flu$y==0])
ewithd= table(pred.shot[flu$y==0])[1]/length(flu$y[flu$y==1])
toterr=enotd+ewithd
eror=c(c1,enotd,ewithd,toterr)
}
eror
for(c1 in cutoff){
pred.shot<-(risk>c1)
enotd=table(pred.shot[flu$y==0])[2]/length(flu$y[flu$y==0])
ewithd= table(pred.shot[flu$y==0])[1]/length(flu$y[flu$y==1])
toterr=enotd+ewithd
eror=c(c1,enotd,ewithd,toterr)
print(eror)
}
table(pred.shot[flu$y==0])[1]
c1=0.05
pred.shot<-(risk>c1)
enotd=table(pred.shot[flu$y==0])[2]/length(flu$y[flu$y==0])
ewithd= table(pred.shot[flu$y==1])[1]/length(flu$y[flu$y==1])
enotd
ewithd
cutoff<-seq(0.05,0.2, by=0.05)
risk<-m1$fitted.values
for(c1 in cutoff){
pred.shot<-(risk>c1)
enotd=table(pred.shot[flu$y==0])[2]/length(flu$y[flu$y==0])
ewithd= table(pred.shot[flu$y==1])[1]/length(flu$y[flu$y==1])
toterr=enotd+ewithd
eror=c(c1,enotd,ewithd,toterr)
print(eror)
}
install.packages(ROCR)
install.packages("ROCR")
library(ROCR)
pred <- prediction(m1$fitted.values, labels=pima[train,]$test )
pred <- prediction(m1$fitted.values )
pred <- prediction(m1$fitted.values, labels=flu)
?performance
perf <- performance(m1$fitted.values, "tpr", "fpr")
pred <- prediction(m1$fitted.values, labels=flu$y )
pred
perf <- performance(pred, "tpr", "fpr")
plot(perf)
abline(0,1)
